services:
  # 1 Blockchain in debug mode
  chain:
    image: node:20-alpine
    platform: linux/arm64/v8
    working_dir: /app
    volumes:
      - ./services/smart-contracts:/app

    # this is to keep alive forever, do not run anything yet
    command: sh -c "npm install && npx hardhat node --hostname 0.0.0.0 --port 8545"

    ports:
      - "8545:8545"

  # the dashboard
  dashboard:
    image: python:3.9-slim
    platform: linux/arm64/v8
    working_dir: /app
    volumes:
      - ./services/smart-contracts/dashboard:/app
      - ./services/smart-contracts/config:/config:ro
    environment:
      CHAINPROOF_RPC_URL: ${CHAINPROOF_RPC_URL:-http://chain:8545}
      CHAINPROOF_CHAIN_ID: ${CHAINPROOF_CHAIN_ID:-1337}
      CHAINPROOF_CONTRACT_KEY: ${CHAINPROOF_CONTRACT_KEY:-chainproof}
      CHAINPROOF_REGISTRY_PATH: ${CHAINPROOF_REGISTRY_PATH:-/config/contracts.json}
    command: sh -c "pip install web3 streamlit && streamlit run app.py"
    ports:
      - "8501:8501"
    depends_on:
      - chain
